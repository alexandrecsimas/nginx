# Define a rede que será usada pelos serviços.
# Isso garante que todos os contêineres neste arquivo possam se comunicar pelo nome.
networks:
  webserver_network:
    driver: bridge

# Para que outros contêineres (de outros arquivos compose.yaml) possam se conectar a esta rede,
# eles devem declarar a rede como externa em seus próprios arquivos compose.yaml, utilizando o nome completo:

# networks:
#   default:  # Ou o nome que você desejar para esta rede dentro do novo compose.yaml
#     external:
#       name: webserver_network  # Substitua 'webserver' pelo nome do diretório onde este compose.yaml está.

# Volumes externos compartilhados para configurações Nginx
volumes:
  nginx-main-config:
    external: true
    name: nginx-main-config
  nginx-sites-available:
    external: true
    name: nginx-sites-available
  nginx-sites-enabled:
    external: true
    name: nginx-sites-enabled

services:
  webserver:
    image: nginx:alpine
    container_name: nginx-webserver
    ports:
      - "${LARAVEL_PORT:-80}:80"
    healthcheck:
      test: [ "CMD", "wget", "--spider", "-q", "http://localhost:${LARAVEL_PORT:-80}/" ]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 30s
    volumes:
      - ./nginx/conf.d:/etc/nginx/conf.d
      - ./nginx/main-config:/etc/nginx/nginx.conf:ro
      - ./nginx/sites-available:/etc/nginx/sites-available:ro
      - ./nginx/sites-enabled:/etc/nginx/sites-enabled:ro
      - ./logs/nginx:/var/log/nginx
    networks:
      - webserver_network

